<!doctype html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Enter Password</title>
<style>
  body { font-family: system-ui, sans-serif; max-width: 560px; margin: 6rem auto; padding: 0 1rem; }
  input, button { font-size: 1rem; padding: .6rem .8rem; }
  #flag { margin-top: 1rem; font-weight: bold; font-size: 1.1rem; }
  .card { border: 1px solid #ddd; border-radius: 12px; padding: 1.2rem; box-shadow: 0 2px 10px rgba(0,0,0,.05); }
</style>
<div class="card">
  <h2>Enter Password</h2>
  <p>パスワードを入力してください。</p>
  <input id="pwd" type="password" placeholder="password" />
  <button id="go">Unlock</button>
  <div id="msg"></div>
  <div id="flag"></div>
</div>
<script>
const params = {
  "salt": "Zs/o1NSbjy5sFVAUiKdSVw==",
  "iv": "nHoBqXs5G5ZhW7VU",
  "ct": "w2JXIYm6wVBRC3Ur1QzcXjN2Xe3hSV0c4uRZrtjo",
  "iter": 100000
};

const b64 = s => Uint8Array.from(atob(s), c => c.charCodeAt(0));
async function deriveKey(password, salt, iter=100000){
  const enc = new TextEncoder();
  const keyMaterial = await crypto.subtle.importKey("raw", enc.encode(password), "PBKDF2", false, ["deriveBits","deriveKey"]);
  return await crypto.subtle.deriveKey(
    { name: "PBKDF2", salt, iterations: iter, hash: "SHA-256" },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    false,
    ["decrypt"]
  );
}
function splitCtAndTag(buf){
  const tagLen = 16;
  const ct = buf.slice(0, buf.length - tagLen);
  const tag = buf.slice(buf.length - tagLen);
  return {ct, tag};
}

async function unlock() {
  const pwd = document.getElementById('pwd').value;
  const msg = document.getElementById('msg');
  const flag = document.getElementById('flag');
  msg.textContent = ""; flag.textContent = "";
  try {
    const salt = b64(params.salt);
    const iv   = b64(params.iv);
    const ctAll= b64(params.ct);
    const {ct, tag} = splitCtAndTag(ctAll);

    const key = await deriveKey(pwd, salt, params.iter);
    const ctWithTag = new Uint8Array(ct.length + tag.length);
    ctWithTag.set(ct, 0); ctWithTag.set(tag, ct.length);

    const ptBuf = await crypto.subtle.decrypt(
      { name: "AES-GCM", iv, tagLength: 128 },
      key,
      ctWithTag
    );
    const dec = new TextDecoder().decode(ptBuf);
    flag.textContent = dec;  
  } catch (e) {
    msg.textContent = "Incorrect password.";
  }
}

document.getElementById('go').addEventListener('click', unlock);
document.getElementById('pwd').addEventListener('keydown', e => {
  if(e.key === 'Enter') unlock();
});
</script>
</html>

